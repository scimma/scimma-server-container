# Server Container Details

For the packages installed, the best documentation is the [Dockerfile.server file itself](../Dockerfile.server).

## EntryPont

The entrypoint of the scimma/server container is:


```
    /root/runServer
```

which is a Perl script that:

    1. Creates SSL Keys and Certificates
    2. Configures Kafka
    3. Creates a kafkacat config file
    4. Runs Zookeeper
    5. Runs Kafka

It takes serveral options:

## SSL Keys and Certificates

The runServer script calls:

```
    /root/configure SSL.pl
```

to configure SSL. This is a very short script that runs a few keytool and openssl commands
to generate:

    1. A key for the server with appropriate subject alt names
    2. A self-signed key that acts as a certificate authority
    3. A server keystore and truststore used by Kafka
    4. A client truststore that could potentially be used by clients
    5. A cacert.pem file that can be used by SSL clients to trust the certificate authority

All of these files are written in:

```
     /root/shared/tls
```

## Kafka Configuration

The main Kafka configuration file is:

```
     /etc/kafka/server.properties
```

It contains configuration for the network interfaces and ports to listen on, passwords, and it references the SSL Key and certificate configuration above.

# Kafkacat config file

The kafkacat config file is written to:

```
     /root/shared/kafkacat.conf
```

The ``kafkacat.conf`` file is not very useful there. However, the scimma/client container 
has a symbolic link:

```
    /root/.config/kafkacat.conf   ->     /root/shared/kafkacat.conf
```

If the server and client are started with a named volume like so (server first):

```
     -v shared:/root/shared
```

Then the kafkacat configuration symbolic link in the client container will point to the
kafkacat configuration file generated by ``runServer``. The kafkacat configuration file
looks like:

```
  sl.ca.location=/root/shared/tls/cacert.pem
  security.protocol=SASL_SSL
  sasl.mechanism=PLAIN
  sasl.username=test
  sasl.password=test-pass

```

## Running kafka and zookeeper

The ``runServer`` script runs one instance each of kafka and zookeeper. Should they exit, they are restarted.
